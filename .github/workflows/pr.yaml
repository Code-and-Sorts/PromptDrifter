name: PR Checks and TestPyPI Publish

on:
  pull_request:
    branches: [ main ]
    types: [opened, synchronize, reopened]

jobs:
  build-and-test:
    uses: ./.github/workflows/shared-build-and-test.yaml
    with:
      os-matrix: '["macos-latest", "windows-latest"]'
      upload-artifacts: true
      artifact-name: 'python-package-dist'
      update-version-for-pr: true

  publish-to-testpypi:
    needs: build-and-test
    uses: ./.github/workflows/shared-publish-package.yaml
    with:
      is-test-pypi: true
    secrets: inherit
